name: CI/CD Pipeline

# Exécution à chaque push sur main
on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Donnez la permission d'écriture pour la branche gh-pages

    steps:
      # 1. Cloner le dépôt
      - uses: actions/checkout@v3

      # 2. Installer Docker
      - name: Set up Docker
        uses: docker/setup-buildx-action@v2

      # 3. Construire l'image Docker
      - name: Build Docker image
        run: docker build -t hang_men .

      # 4. Lancer les tests (ici, juste vérifier que index.html existe)
      - name: Verify site
        run: |
          if [ ! -f index.html]; then
            echo "Error: index.html not found"
            exit 1
          fi

      # 5. Optionnel : pousser l'image vers Docker Hub
      # - name: Push to Docker Hub
      #   uses: docker/login-action@v2
      #   with:
      #     username: ${{ secrets.DOCKER_USERNAME }}
      #     password: ${{ secrets.DOCKER_PASSWORD }}
      #   run: |
      #     docker tag hang_men yourdockerhubusername/hang_men:latest
      #     docker push yourdockerhubusername/hang_men:latest
   
